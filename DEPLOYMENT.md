# QMS-ERP Deployment Guide

## Deployment to Render

This application is configured for easy deployment to Render using Docker and Blueprint.

### Prerequisites
- GitHub account
- Render account (free tier available)
- Git installed locally

### Step 1: Push to GitHub

1. **Add all changes:**
```bash
git add .
```

2. **Commit changes:**
```bash
git commit -m "Add complete QMS-ERP system with Render deployment config"
```

3. **Push to GitHub:**
```bash
git push origin master
```

### Step 2: Deploy on Render

#### Option A: Using Blueprint (Recommended)

1. **Go to Render Dashboard:**
   - Visit https://dashboard.render.com/

2. **Create New Blueprint:**
   - Click "New" → "Blueprint"
   - Connect your GitHub repository: `vraj1091/Compliance_management`
   - Render will automatically detect the `render.yaml` file

3. **Configure Blueprint:**
   - Name: `qms-erp-app`
   - Branch: `master`
   - Click "Apply"

4. **Wait for Deployment:**
   - Render will build the Docker image
   - Deploy the application
   - This takes 5-10 minutes for first deployment

5. **Access Your App:**
   - Once deployed, you'll get a URL like: `https://qms-erp-app.onrender.com`

#### Option B: Manual Docker Deployment

1. **Go to Render Dashboard:**
   - Visit https://dashboard.render.com/

2. **Create New Web Service:**
   - Click "New" → "Web Service"
   - Connect your GitHub repository

3. **Configure Service:**
   - **Name:** `qms-erp-app`
   - **Region:** Oregon (US West)
   - **Branch:** `master`
   - **Runtime:** Docker
   - **Plan:** Free

4. **Environment Variables:**
   Add these in the Render dashboard:
   ```
   DATABASE_URL=sqlite+aiosqlite:///./qms_erp.db
   SECRET_KEY=<auto-generated-by-render>
   ALGORITHM=HS256
   ACCESS_TOKEN_EXPIRE_MINUTES=480
   APP_NAME=Medical Device QMS-ERP
   APP_VERSION=1.0.0
   DEBUG=false
   ```

5. **Deploy:**
   - Click "Create Web Service"
   - Wait for build and deployment

### Step 3: Access the Application

1. **Get Your URL:**
   - Render provides a URL like: `https://qms-erp-app.onrender.com`

2. **Login:**
   - Username: `admin`
   - Password: `Admin@123`

3. **First Time Setup:**
   - The database will be automatically initialized on first run
   - Default admin user will be created
   - Sample data will be seeded

### Architecture

```
┌─────────────────────────────────────────┐
│         Render Cloud Platform           │
├─────────────────────────────────────────┤
│                                         │
│  ┌───────────────────────────────────┐ │
│  │     Docker Container              │ │
│  │                                   │ │
│  │  ┌─────────────────────────────┐ │ │
│  │  │   Frontend (React/Vite)     │ │ │
│  │  │   Built Static Files        │ │ │
│  │  └─────────────────────────────┘ │ │
│  │              ↓                    │ │
│  │  ┌─────────────────────────────┐ │ │
│  │  │   Backend (FastAPI)         │ │ │
│  │  │   - API Endpoints           │ │ │
│  │  │   - Static File Serving     │ │ │
│  │  └─────────────────────────────┘ │ │
│  │              ↓                    │ │
│  │  ┌─────────────────────────────┐ │ │
│  │  │   SQLite Database           │ │ │
│  │  │   (Persistent Volume)       │ │ │
│  │  └─────────────────────────────┘ │ │
│  └───────────────────────────────────┘ │
│                                         │
└─────────────────────────────────────────┘
```

### Build Process

The Dockerfile uses a multi-stage build:

1. **Stage 1: Frontend Build**
   - Uses Node.js 18 Alpine
   - Installs npm dependencies
   - Builds React app with Vite
   - Outputs to `dist/` folder

2. **Stage 2: Backend + Frontend**
   - Uses Python 3.11 Slim
   - Installs Python dependencies
   - Copies backend code
   - Copies built frontend from Stage 1
   - Initializes database on startup
   - Serves both API and frontend

### Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `DATABASE_URL` | SQLite database connection | `sqlite+aiosqlite:///./qms_erp.db` |
| `SECRET_KEY` | JWT secret key | Auto-generated |
| `ALGORITHM` | JWT algorithm | `HS256` |
| `ACCESS_TOKEN_EXPIRE_MINUTES` | Token expiry time | `480` (8 hours) |
| `APP_NAME` | Application name | `Medical Device QMS-ERP` |
| `APP_VERSION` | Version number | `1.0.0` |
| `DEBUG` | Debug mode | `false` |

### Persistent Storage

**Important:** Render's free tier uses ephemeral storage. The database will reset on:
- Service restarts
- Deployments
- Inactivity (after 15 minutes)

**For Production:**
- Upgrade to paid plan for persistent disk
- Or use external database (PostgreSQL)

### Monitoring

1. **Health Check:**
   - Endpoint: `/health`
   - Returns: `{"status": "ok"}`

2. **Logs:**
   - View in Render dashboard
   - Real-time log streaming

3. **Metrics:**
   - CPU usage
   - Memory usage
   - Request count

### Troubleshooting

#### Build Fails

**Issue:** Docker build fails
**Solution:**
- Check Dockerfile syntax
- Verify all files are committed
- Check build logs in Render

#### Database Not Initialized

**Issue:** Login fails with "User not found"
**Solution:**
- Check startup logs
- Verify seed.py runs successfully
- Restart the service

#### Frontend Not Loading

**Issue:** Blank page or 404 errors
**Solution:**
- Verify frontend build succeeded
- Check static files are copied
- Inspect browser console for errors

#### API Errors

**Issue:** API calls fail
**Solution:**
- Check CORS settings
- Verify API endpoints
- Check backend logs

### Updating the Application

1. **Make changes locally**
2. **Test locally:**
   ```bash
   docker build -t qms-erp .
   docker run -p 8000:8000 qms-erp
   ```
3. **Commit and push:**
   ```bash
   git add .
   git commit -m "Update: description"
   git push origin master
   ```
4. **Auto-deploy:**
   - Render automatically deploys on push
   - Monitor deployment in dashboard

### Custom Domain

1. **Go to Service Settings**
2. **Click "Custom Domain"**
3. **Add your domain:**
   - Example: `qms.yourcompany.com`
4. **Update DNS:**
   - Add CNAME record pointing to Render URL
5. **SSL Certificate:**
   - Automatically provisioned by Render

### Scaling

**Free Tier:**
- 1 instance
- 512 MB RAM
- Shared CPU
- Sleeps after 15 min inactivity

**Paid Plans:**
- Multiple instances
- More RAM/CPU
- No sleep
- Persistent disk
- Custom domains

### Security Considerations

1. **Change Default Password:**
   - Login and change admin password immediately

2. **Environment Variables:**
   - Never commit secrets to Git
   - Use Render's environment variable management

3. **HTTPS:**
   - Automatically enabled by Render
   - Free SSL certificates

4. **Database Backups:**
   - For production, use external database
   - Set up regular backups

### Cost Estimate

**Free Tier:**
- $0/month
- Perfect for testing/demo
- Limitations: sleeps, ephemeral storage

**Starter Plan:**
- $7/month
- Always on
- 512 MB RAM
- Persistent disk

**Standard Plan:**
- $25/month
- 2 GB RAM
- Better performance
- Priority support

### Support

**Render Documentation:**
- https://render.com/docs

**Render Community:**
- https://community.render.com/

**Application Issues:**
- Check GitHub repository issues
- Review application logs

### Next Steps

1. ✅ Deploy to Render
2. ✅ Test all functionality
3. ✅ Change default passwords
4. ✅ Configure custom domain (optional)
5. ✅ Set up monitoring
6. ✅ Plan for production database
7. ✅ Configure backups

---

**Deployment Status:** Ready for Render
**Last Updated:** January 27, 2026
**Version:** 1.0.0
